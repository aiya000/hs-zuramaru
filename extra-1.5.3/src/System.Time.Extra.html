<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">-- | Extra functions for working with times. Unlike the other modules in this package, there is no</span><span>
</span><a name="line-4"></a><span class="hs-comment">--   corresponding @System.Time@ module. This module enhances the functionality</span><span>
</span><a name="line-5"></a><span class="hs-comment">--   from &quot;Data.Time.Clock&quot;, but in quite different ways.</span><span>
</span><a name="line-6"></a><span class="hs-comment">--</span><span>
</span><a name="line-7"></a><span class="hs-comment">--   Throughout, time is measured in 'Seconds', which is a type alias for 'Double'.</span><span>
</span><a name="line-8"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Time</span><span class="hs-operator">.</span><span class="hs-identifier">Extra</span><span class="hs-special">(</span><span>
</span><a name="line-9"></a><span>    </span><a href="System.Time.Extra.html#Seconds"><span class="hs-identifier hs-type">Seconds</span></a><span class="hs-special">,</span><span>
</span><a name="line-10"></a><span>    </span><a href="System.Time.Extra.html#sleep"><span class="hs-identifier hs-var">sleep</span></a><span class="hs-special">,</span><span> </span><a href="System.Time.Extra.html#timeout"><span class="hs-identifier hs-var">timeout</span></a><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>    </span><a href="System.Time.Extra.html#subtractTime"><span class="hs-identifier hs-var">subtractTime</span></a><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>    </span><a href="System.Time.Extra.html#showDuration"><span class="hs-identifier hs-var">showDuration</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>    </span><a href="System.Time.Extra.html#offsetTime"><span class="hs-identifier hs-var">offsetTime</span></a><span class="hs-special">,</span><span> </span><a href="System.Time.Extra.html#offsetTimeIncrease"><span class="hs-identifier hs-var">offsetTimeIncrease</span></a><span class="hs-special">,</span><span> </span><a href="System.Time.Extra.html#duration"><span class="hs-identifier hs-var">duration</span></a><span>
</span><a name="line-14"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Concurrent</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Time</span><span class="hs-operator">.</span><span class="hs-identifier">Clock</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Clock</span><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="Numeric.Extra.html"><span class="hs-identifier">Numeric</span><span class="hs-operator">.</span><span class="hs-identifier">Extra</span></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><a href="Control.Monad.Extra.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Extra</span></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><a href="Control.Exception.Extra.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Exception</span><span class="hs-operator">.</span><span class="hs-identifier">Extra</span></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Typeable</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Unique</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-comment">-- | A type alias for seconds, which are stored as 'Double'.</span><span>
</span><a name="line-27"></a><span class="hs-keyword">type</span><span> </span><a name="Seconds"><a href="System.Time.Extra.html#Seconds"><span class="hs-identifier">Seconds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Double</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span class="hs-comment">-- | Sleep for a number of seconds.</span><span>
</span><a name="line-30"></a><span class="hs-comment">--</span><span>
</span><a name="line-31"></a><span class="hs-comment">-- &gt; fmap (round . fst) (duration $ sleep 1) == return 1</span><span>
</span><a name="line-32"></a><span class="hs-identifier">sleep</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Time.Extra.html#Seconds"><span class="hs-identifier hs-type">Seconds</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><a name="sleep"><a href="System.Time.Extra.html#sleep"><span class="hs-identifier">sleep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Monad.Extra.html#loopM"><span class="hs-identifier hs-var">loopM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679055358"><a href="#local-6989586621679055358"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-34"></a><span>    </span><span class="hs-comment">-- important to handle both overflow and underflow vs Int</span><span>
</span><a name="line-35"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679055358"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-36"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679055358"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">2000</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-38"></a><span>        </span><span class="hs-identifier hs-var">threadDelay</span><span> </span><span class="hs-number">2000000000</span><span> </span><span class="hs-comment">-- 2000 * 1e6</span><span>
</span><a name="line-39"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679055358"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">2000</span><span>
</span><a name="line-40"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-41"></a><span>        </span><span class="hs-identifier hs-var">threadDelay</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">ceiling</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679055358"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">1000000</span><span>
</span><a name="line-42"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-comment">-- An internal type that is thrown as a dynamic exception to</span><span>
</span><a name="line-46"></a><span class="hs-comment">-- interrupt the running IO computation when the timeout has</span><span>
</span><a name="line-47"></a><span class="hs-comment">-- expired.</span><span>
</span><a name="line-48"></a><span class="hs-keyword">newtype</span><span> </span><a name="Timeout"><a href="System.Time.Extra.html#Timeout"><span class="hs-identifier">Timeout</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Timeout"><a href="System.Time.Extra.html#Timeout"><span class="hs-identifier">Timeout</span></a></a><span> </span><span class="hs-identifier hs-type">Unique</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Typeable</span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="System.Time.Extra.html#Timeout"><span class="hs-identifier hs-type">Timeout</span></a><span> </span><span class="hs-keyword">where</span><span> </span><a name="local-8214565720323790720"><span class="hs-identifier">show</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&lt;&lt;timeout&gt;&gt;&quot;</span><span>
</span><a name="line-50"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Exception</span><span> </span><a href="System.Time.Extra.html#Timeout"><span class="hs-identifier hs-type">Timeout</span></a><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-comment">-- | A version of 'System.Timeout.timeout' that takes 'Seconds' and never</span><span>
</span><a name="line-54"></a><span class="hs-comment">--   overflows the bounds of an 'Int'. In addition, the bug that negative</span><span>
</span><a name="line-55"></a><span class="hs-comment">--   timeouts run for ever has been fixed.</span><span>
</span><a name="line-56"></a><span class="hs-comment">--</span><span>
</span><a name="line-57"></a><span class="hs-comment">-- &gt; timeout (-3) (print 1) == return Nothing</span><span>
</span><a name="line-58"></a><span class="hs-comment">-- &gt; timeout 0.1  (print 1) == fmap Just (print 1)</span><span>
</span><a name="line-59"></a><span class="hs-comment">-- &gt; do (t, _) &lt;- duration $ timeout 0.1 $ sleep 1000; print t; return $ t &lt; 1</span><span>
</span><a name="line-60"></a><span class="hs-comment">-- &gt; timeout 0.1  (sleep 2 &gt;&gt; print 1) == return Nothing</span><span>
</span><a name="line-61"></a><span class="hs-identifier">timeout</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Time.Extra.html#Seconds"><span class="hs-identifier hs-type">Seconds</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679055357"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679055357"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span class="hs-comment">-- Copied from GHC with a few tweaks.</span><span>
</span><a name="line-63"></a><a name="timeout"><a href="System.Time.Extra.html#timeout"><span class="hs-identifier">timeout</span></a></a><span> </span><a name="local-6989586621679055396"><a href="#local-6989586621679055396"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679055397"><a href="#local-6989586621679055397"><span class="hs-identifier">f</span></a></a><span>
</span><a name="line-64"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679055396"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-65"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-66"></a><span>        </span><a name="local-6989586621679055817"><a href="#local-6989586621679055817"><span class="hs-identifier">pid</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">myThreadId</span><span>
</span><a name="line-67"></a><span>        </span><a name="local-6989586621679055818"><a href="#local-6989586621679055818"><span class="hs-identifier">ex</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="System.Time.Extra.html#Timeout"><span class="hs-identifier hs-var">Timeout</span></a><span> </span><span class="hs-identifier hs-var">newUnique</span><span>
</span><a name="line-68"></a><span>        </span><a href="Control.Exception.Extra.html#handleBool"><span class="hs-identifier hs-var">handleBool</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679055818"><span class="hs-identifier hs-var">ex</span></a><span class="hs-special">)</span><span> </span><span>
</span><a name="line-69"></a><span>                   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-70"></a><span>                   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">bracket</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">forkIOWithUnmask</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679055819"><a href="#local-6989586621679055819"><span class="hs-identifier">unmask</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679055819"><span class="hs-identifier hs-var">unmask</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Time.Extra.html#sleep"><span class="hs-identifier hs-var">sleep</span></a><span> </span><a href="#local-6989586621679055396"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">throwTo</span><span> </span><a href="#local-6989586621679055817"><span class="hs-identifier hs-var">pid</span></a><span> </span><a href="#local-6989586621679055818"><span class="hs-identifier hs-var">ex</span></a><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span>                            </span><span class="hs-identifier hs-var">killThread</span><span>
</span><a name="line-72"></a><span>                            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679055397"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span class="hs-comment">-- Once we remove subtractTime we can remove the dependency on the time package entire.</span><span>
</span><a name="line-76"></a><span class="hs-pragma">{-# DEPRECATED subtractTime &quot;Function is being retired - use diffUTCTime directly.&quot; #-}</span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-comment">-- | Calculate the difference between two times in seconds.</span><span>
</span><a name="line-79"></a><span class="hs-comment">--   Usually the first time will be the end of an event, and the</span><span>
</span><a name="line-80"></a><span class="hs-comment">--   second time will be the beginning.</span><span>
</span><a name="line-81"></a><span class="hs-identifier">subtractTime</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">UTCTime</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">UTCTime</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Time.Extra.html#Seconds"><span class="hs-identifier hs-type">Seconds</span></a><span>
</span><a name="line-82"></a><a name="subtractTime"><a href="System.Time.Extra.html#subtractTime"><span class="hs-identifier">subtractTime</span></a></a><span> </span><a name="local-6989586621679055820"><a href="#local-6989586621679055820"><span class="hs-identifier">end</span></a></a><span> </span><a name="local-6989586621679055821"><a href="#local-6989586621679055821"><span class="hs-identifier">start</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromRational</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toRational</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679055820"><span class="hs-identifier hs-var">end</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">diffUTCTime</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679055821"><span class="hs-identifier hs-var">start</span></a><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span class="hs-comment">-- | Show a number of seconds, typically a duration, in a suitable manner with</span><span>
</span><a name="line-86"></a><span class="hs-comment">--   responable precision for a human.</span><span>
</span><a name="line-87"></a><span class="hs-comment">--</span><span>
</span><a name="line-88"></a><span class="hs-comment">-- &gt; showDuration 3.435   == &quot;3.44s&quot;</span><span>
</span><a name="line-89"></a><span class="hs-comment">-- &gt; showDuration 623.8   == &quot;10m24s&quot;</span><span>
</span><a name="line-90"></a><span class="hs-comment">-- &gt; showDuration 62003.8 == &quot;17h13m&quot;</span><span>
</span><a name="line-91"></a><span class="hs-comment">-- &gt; showDuration 1e8     == &quot;27777h47m&quot;</span><span>
</span><a name="line-92"></a><span class="hs-identifier">showDuration</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Time.Extra.html#Seconds"><span class="hs-identifier hs-type">Seconds</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-93"></a><a name="showDuration"><a href="System.Time.Extra.html#showDuration"><span class="hs-identifier">showDuration</span></a></a><span> </span><a name="local-6989586621679055835"><a href="#local-6989586621679055835"><span class="hs-identifier">x</span></a></a><span>
</span><a name="line-94"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679055835"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">3600</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679055836"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055835"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">/</span><span> </span><span class="hs-number">60</span><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;h&quot;</span><span> </span><span class="hs-string">&quot;m&quot;</span><span>
</span><a name="line-95"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679055835"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">60</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679055836"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679055835"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-string">&quot;m&quot;</span><span> </span><span class="hs-string">&quot;s&quot;</span><span>
</span><a name="line-96"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Numeric.Extra.html#showDP"><span class="hs-identifier hs-var">showDP</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621679055835"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;s&quot;</span><span>
</span><a name="line-97"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-98"></a><span>        </span><a name="local-6989586621679055836"><a href="#local-6989586621679055836"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679055837"><a href="#local-6989586621679055837"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679055838"><a href="#local-6989586621679055838"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679055839"><a href="#local-6989586621679055839"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679055840"><span class="hs-identifier hs-var">ms</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679055838"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span class="hs-char">'0'</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679055841"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">10</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679055841"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679055839"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-99"></a><span>            </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679055840"><a href="#local-6989586621679055840"><span class="hs-identifier">ms</span></a></a><span class="hs-special">,</span><a name="local-6989586621679055841"><a href="#local-6989586621679055841"><span class="hs-identifier">ss</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">round</span><span> </span><a href="#local-6989586621679055837"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">divMod</span><span class="hs-special">`</span><span> </span><span class="hs-number">60</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-comment">-- | Call once to start, then call repeatedly to get the elapsed time since the first call.</span><span>
</span><a name="line-103"></a><span class="hs-comment">--   The time is guaranteed to be monotonic. This function is robust to system time changes.</span><span>
</span><a name="line-104"></a><span class="hs-comment">--</span><span>
</span><a name="line-105"></a><span class="hs-comment">-- &gt; do f &lt;- offsetTime; xs &lt;- replicateM 10 f; return $ xs == sort xs</span><span>
</span><a name="line-106"></a><span class="hs-identifier">offsetTime</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IO</span><span> </span><a href="System.Time.Extra.html#Seconds"><span class="hs-identifier hs-type">Seconds</span></a><span class="hs-special">)</span><span>
</span><a name="line-107"></a><a name="offsetTime"><a href="System.Time.Extra.html#offsetTime"><span class="hs-identifier">offsetTime</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-108"></a><span>    </span><a name="local-6989586621679055843"><a href="#local-6989586621679055843"><span class="hs-identifier">start</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679055842"><span class="hs-identifier hs-var">time</span></a><span>
</span><a name="line-109"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-110"></a><span>        </span><a name="local-6989586621679055844"><a href="#local-6989586621679055844"><span class="hs-identifier">end</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679055842"><span class="hs-identifier hs-var">time</span></a><span>
</span><a name="line-111"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-number">1e-9</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toNanoSecs</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679055844"><span class="hs-identifier hs-var">end</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679055843"><span class="hs-identifier hs-var">start</span></a><span class="hs-special">)</span><span>
</span><a name="line-112"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055842"><a href="#local-6989586621679055842"><span class="hs-identifier">time</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getTime</span><span> </span><span class="hs-identifier hs-var">Monotonic</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-pragma">{-# DEPRECATED offsetTimeIncrease &quot;Use offsetTime instead, which is guaranteed to always increase.&quot; #-}</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-comment">-- | A synonym for 'offsetTime'.</span><span>
</span><a name="line-117"></a><span class="hs-identifier">offsetTimeIncrease</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IO</span><span> </span><a href="System.Time.Extra.html#Seconds"><span class="hs-identifier hs-type">Seconds</span></a><span class="hs-special">)</span><span>
</span><a name="line-118"></a><a name="offsetTimeIncrease"><a href="System.Time.Extra.html#offsetTimeIncrease"><span class="hs-identifier">offsetTimeIncrease</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Time.Extra.html#offsetTime"><span class="hs-identifier hs-var">offsetTime</span></a><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-comment">-- | Record how long a computation takes in 'Seconds'.</span><span>
</span><a name="line-121"></a><span class="hs-comment">--</span><span>
</span><a name="line-122"></a><span class="hs-comment">-- &gt; do (a,_) &lt;- duration $ sleep 1; return $ a &gt;= 1 &amp;&amp; a &lt;= 1.1</span><span>
</span><a name="line-123"></a><span class="hs-identifier">duration</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679055018"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="System.Time.Extra.html#Seconds"><span class="hs-identifier hs-type">Seconds</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679055018"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-124"></a><a name="duration"><a href="System.Time.Extra.html#duration"><span class="hs-identifier">duration</span></a></a><span> </span><a name="local-6989586621679055845"><a href="#local-6989586621679055845"><span class="hs-identifier">act</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-125"></a><span>    </span><a name="local-6989586621679055846"><a href="#local-6989586621679055846"><span class="hs-identifier">time</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Time.Extra.html#offsetTime"><span class="hs-identifier hs-var">offsetTime</span></a><span>
</span><a name="line-126"></a><span>    </span><a name="local-6989586621679055847"><a href="#local-6989586621679055847"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679055845"><span class="hs-identifier hs-var">act</span></a><span>
</span><a name="line-127"></a><span>    </span><a name="local-6989586621679055848"><a href="#local-6989586621679055848"><span class="hs-identifier">time</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679055846"><span class="hs-identifier hs-var">time</span></a><span>
</span><a name="line-128"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055848"><span class="hs-identifier hs-var">time</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679055847"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span>
</span><a name="line-129"></a></pre></body></html>